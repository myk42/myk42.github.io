---
import { getCollection, type CollectionEntry } from "astro:content";
import { FRONTPAGE_POST_COUNT } from "astro:env/client";
import { getNewestPosts } from "../scripts/sort.js";
import { getFeaturedPosts } from "../scripts/filter.js";
import BaseLayout from "../layouts/BaseLayout.astro";
import Card from "../components/Card.astro";

const posts = await getCollection("posts");
const featuredPosts = getNewestPosts(getFeaturedPosts(posts)).slice(0, FRONTPAGE_POST_COUNT);
const newestPosts = getNewestPosts(posts).slice(0, FRONTPAGE_POST_COUNT);

console.log(featuredPosts.length);
---

<BaseLayout>
  {
    featuredPosts.length > 0 && (
      <div class="collection-container">
        <h2 class="heading">Featured Posts</h2>
        <div class="collection-grid">
          {featuredPosts.map((post: CollectionEntry<"posts">) => (
            <Card post={post} badge={true} />
          ))}
        </div>
      </div>
    )
  }

  <div class="collection-container">
    <h2 class="heading">Latest Posts</h2>
    <div class="collection-grid">
      {newestPosts.map((post: CollectionEntry<"posts">) => <Card post={post} badge={true} />)}
    </div>
  </div>
</BaseLayout>
